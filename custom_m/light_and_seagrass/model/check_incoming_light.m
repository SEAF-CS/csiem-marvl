clear; close all;

wavei = [140.00, 150.00, 160.00, 170.00, ...
    180.00, 190.00, 200.00, 205.00, 210.00, 215.00, 220.00, ...
    225.00, 230.00, 235.00, 240.00, 245.00, 250.00, 255.00, ...
    260.00, 265.00, 270.00, 275.00, 280.00, 285.00, 290.00, ...
    295.00, 300.00, 305.00, 310.00, 315.00, 320.00, 325.00, ...
    330.00, 335.00, 340.00, 345.00, 350.00, 355.00, 360.00, ...
    365.00, 370.00, 375.00, 380.00, 385.00, 390.00, 395.00, ...
    400.00, 405.00, 410.00, 415.00, 420.00, 425.00, 430.00, ...
    435.00, 440.00, 445.00, 450.00, 455.00, 460.00, 465.00, ...
    470.00, 475.00, 480.00, 485.00, 490.00, 495.00, 500.00, ...
    505.00, 510.00, 515.00, 520.00, 525.00, 530.00, 535.00, ...
    540.00, 545.00, 550.00, 555.00, 560.00, 565.00, 570.00, ...
    575.00, 580.00, 585.00, 590.00, 595.00, 600.00, 610.00, ...
    620.00, 630.00, 640.00, 650.00, 660.00, 670.00, 680.00, ...
    690.00, 700.00, 710.00, 720.00, 730.00, 740.00, 750.00, ...
    800.00, 850.00, 900.00, 950.00, 1000.00, 1100.00, 1200.00, ...
    1300.00, 1400.00, 1500.00, 1600.00, 1700.00, 1800.00, 1900.00, ...
    2000.00, 2100.00, 2200.00, 2300.00, 2400.00, 2500.00, 2600.00, ...
    2700.00, 2800.00, 2900.00, 3000.00, 3100.00, 3200.00, 3300.00, ...
    3400.00, 3500.00, 3600.00, 3700.00, 3800.00, 3900.00, 4000.00, ...
    4100.00, 4200.00, 4300.00, 4400.00, 4500.00, 4600.00, 4700.00, ...
    4800.00, 4900.00, 5000.00, 6000.00, 7000.00, 8000.00 ];

% clear-sky irradiance at a particular wave-band W/m2/nm, from EMS model
landai = [ 0.0000, 0.0001, 0.0000, 0.0004, ...
    0.0009,0.0017,0.0030,0.0050,0.0100,0.0180,0.0300,0.0420,0.0520, ...
    0.0540,0.0580,0.0640,0.0640,0.1000,0.1300,0.2000,0.2500,0.2200, ...
    0.2400,0.3400,0.5200,0.6300,0.6100,0.6700,0.7600,0.8200,0.8500, ...
    1.0200,1.1500,1.1100,1.1100,1.1700,1.1800,1.1600,1.1600,1.2900, ...
    1.3300,1.3200,1.2300,1.1500,1.1200,1.2000,1.5400,1.8800,1.9400, ...
    1.9200,1.9200,1.8900,1.7800,1.8200,2.0300,2.1500,2.2000,2.1900, ...
    2.1600,2.1500,2.1700,2.2000,2.1600,2.0300,1.9900,2.0400,1.9800, ...
    1.9700,1.9600,1.8900,1.8700,1.9200,1.9500,1.9700,1.9800,1.9800, ...
    1.9500,1.9200,1.9000,1.8900,1.8700,1.8700,1.8700,1.8500,1.8400, ...
    1.8300,1.8100,1.7700,1.7400,1.7000,1.6600,1.6200,1.5900,1.5500, ...
    1.5100,1.4800,1.4400,1.4100,1.3700,1.3400,1.3000,1.2700,1.1270, ...
    1.0030,0.8950,0.8030,0.7250,0.6060,0.5010,0.4060,0.3280,0.2670, ...
    0.2200,0.1820,0.1520,0.1274,0.1079,0.0917,0.0785,0.0676,0.0585, ...
    0.0509,0.0445,0.0390,0.0343,0.0303,0.0268,0.0230,0.0214,0.0191, ...
    0.0171,0.0153,0.0139,0.0125,0.0114,0.0103,0.0095,0.0087,0.0080, ...
    0.0073,0.0067,0.0061,0.0056,0.0051,0.0048,0.0044,0.0042,0.0021, ...
    0.0012,0.0006];

w2i=[398 448 470 524 554 590 628 656 699];

l2i=interp1(wavei,landai,w2i);

%% model
model=load('extracted_2022_restart_newtestv2_SF.mat');

for w=1:16
    tmp1(w,:)=model.output.Kwinana.(['WQ_DIAG_OAS_DIF_SF_BAND',num2str(w)]).bottom;
    tmp2(w,:)=model.output.Kwinana.(['WQ_DIAG_OAS_DIR_SF_BAND',num2str(w)]).bottom;
    modeloutput(w,:)=tmp1(w,:)+tmp2(w,:);
end
bands=    [280., 300., 350., 380., 410.,440.,490.,510.,550.,590.,635.,660.,700., 780., 850., 1100. ];
WL2=      [398 448 470 524 554 590 628 656 699];


%%

figure(1);
plot(wavei,landai,'k');

hold on;

plot(bands,modeloutput(:,2+6*20),'Color','r');
hold on;
plot(bands,tmp1(:,2+6*20),':r');
hold on;
plot(bands,tmp2(:,2+6*20),'--r');

m2i=interp1(bands,modeloutput(:,2+6*20),w2i);

hold on;
plot(w2i,l2i,'ro',...
    'LineWidth',2,...
    'MarkerSize',10,...
    'MarkerEdgeColor','b',...
    'MarkerFaceColor',[0.5,0.5,0.5]);
hold on;

plot(w2i,m2i,'ro',...
    'LineWidth',2,...
    'MarkerSize',10,...
    'MarkerEdgeColor','r',...
    'MarkerFaceColor',[0.5,0.5,0.5]);


hl=legend('Baird 2016','OASIM DIR+DIF','OASIM DIF','OASIM DIR');
set(gca,'xlim',[300 800]);

    pngname='check_air_light_intensity_SF.png';
    saveas(gcf,pngname);